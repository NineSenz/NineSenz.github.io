(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{479:function(s,n,a){"use strict";a.r(n);var e=a(2),t=Object(e.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"一、部署前准备"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一、部署前准备"}},[s._v("#")]),s._v(" 一、部署前准备")]),s._v(" "),n("ul",[n("li",[s._v("部署机器准备")]),s._v(" "),n("li",[s._v("计算机名解析")]),s._v(" "),n("li",[s._v("关闭防火墙、selinux")]),s._v(" "),n("li",[s._v("时间同步")]),s._v(" "),n("li",[s._v("软件包获得")]),s._v(" "),n("li",[s._v("ssh免密登陆")])]),s._v(" "),n("p",[n("strong",[s._v("约定事项：")])]),s._v(" "),n("ol",[n("li",[n("p",[s._v("所有服务器全部采用静态ip")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("主机名称")]),s._v(" "),n("th",[s._v("IP地址")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("manage01")]),s._v(" "),n("td",[s._v("192.168.98.200/24")])]),s._v(" "),n("tr",[n("td",[s._v("node1")]),s._v(" "),n("td",[s._v("192.168.98.201/24")])]),s._v(" "),n("tr",[n("td",[s._v("node2")]),s._v(" "),n("td",[s._v("192.168.98.202/24")])]),s._v(" "),n("tr",[n("td",[s._v("node3")]),s._v(" "),n("td",[s._v("192.168.98.203/24")])])])])]),s._v(" "),n("li",[n("p",[s._v("主机名及主机名互相绑定")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[root@manage01 ~]# cat /etc/hosts\n127.0.0.1   localhost\n::1         localhost \n192.168.98.200\tmanage01\n192.168.98.201\tnode1\n192.168.98.202\tnode2\n192.168.98.203\tnode3\n\n其他机器同理\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("关闭防火墙, selinux")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[root@manage01 ~]# systemctl disable firewalld\n[root@manage01 ~]# sed -i -r '/SELINUX=/c\\SELINUX=disabled' /etc/selinux/config\n[root@manage01 ~]# reboot\n\n\n其他机器同理\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("采用时间服务器，时间同步")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("1、修改配置文件，配置时间服务器为阿里云的时间服务器\n[root@manage01 ~]# egrep \"^server\" /etc/chrony.conf \nserver ntp1.aliyun.com\nserver ntp2.aliyun.com\nserver ntp3.aliyun.com\nserver ntp4.aliyun.com\n\n#注释\n# pool 2.centos.pool.ntp.org iburst\n\n2、重启服务chronyd\n[root@manage01 ~]# systemctl restart chronyd.service \n\n3、查看源信息\n#chronyc chrony的命令行客户端\n[root@manage01 ~]# chronyc sources -v\n210 Number of sources = 2\n\n  .-- Source mode  '^' = server, '=' = peer, '#' = local clock.\n / .- Source state '*' = current synced, '+' = combined , '-' = not combined,\n| /   '?' = unreachable, 'x' = time may be in error, '~' = time too variable.\n||                                                 .- xxxx [ yyyy ] +/- zzzz\n||      Reachability register (octal) -.           |  xxxx = adjusted offset,\n||      Log2(Polling interval) --.      |          |  yyyy = measured offset,\n||                                \\     |          |  zzzz = estimated error.\n||                                 |    |           \\\nMS Name/IP address         Stratum Poll Reach LastRx Last sample               \n===============================================================================\n^? 120.25.115.20                 2   6     1     3   +663us[ +663us] +/-   23ms\n^? 203.107.6.88                  2   6     1     2  -1326us[-1326us] +/-   17ms\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("确认和配置yum源(需要epel源)")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[root@manage01 ~]# yum -y install epel-*\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("6.ssh远程连接")]),s._v(" "),n("p",[s._v("管理端和被管理端连接时基于ssh的，所以有两种连接方式")]),s._v(" "),n("p",[s._v("1）基于ssh口令")]),s._v(" "),n("p",[s._v("2）基于ssh证书（重点讲解）")]),s._v(" "),n("p",[s._v("如果想不需要运维人员干预，被管理端必须允许管理端证书免密登陆。")])]),s._v(" "),n("li",[n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v(' #管理端manage01生成ssh公私钥\n [root@manage01 ~]# ssh-keygen \n Generating public/private rsa key pair.\n Enter file in which to save the key (/root/.ssh/id_rsa): \n Enter passphrase (empty for no passphrase): \n Enter same passphrase again: \n Your identification has been saved in /root/.ssh/id_rsa.\n Your public key has been saved in /root/.ssh/id_rsa.pub.\n The key fingerprint is:\n SHA256:aufJno2QjPK/V63/PVW13h5oWlKu0jk7HesXYTho0gM root@manage01\n The key\'s randomart image is:\n +---[RSA 2048]----+\n |                 |\n |         E      .|\n |          o . . o|\n |         . = + +.|\n |        S o.+ = +|\n |     o o  ...* +o|\n |  . . * ....O o.+|\n |   o . =.*.B o +.|\n |    ..o+B oo*oo o|\n +----[SHA256]-----+\n \n #将公钥传给node1\n [root@manage01 ~]# ssh-copy-id -i .ssh/id_rsa.pub root@192.168.98.201\n /usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: ".ssh/id_rsa.pub"\n The authenticity of host \'192.168.98.201 (192.168.98.201)\' can\'t be established.\n ECDSA key fingerprint is SHA256:u+yOQz+E+eF7Oixdz/vClLXlAEu/7K8jy783gzk20dQ.\n ECDSA key fingerprint is MD5:c0:80:1b:ae:93:32:c2:66:f5:da:2f:1c:26:1e:7e:f8.\n Are you sure you want to continue connecting (yes/no)? yes\n /usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed\n /usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys\n root@192.168.98.201\'s password: \n \n Number of key(s) added: 1\n \n Now try logging into the machine, with:   "ssh \'root@192.168.98.201\'"\n and check to make sure that only the key(s) you wanted were added.\n \n #将公钥传给node2\n [root@manage01 ~]# ssh-copy-id -i .ssh/id_rsa.pub root@192.168.98.202\n /usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: ".ssh/id_rsa.pub"\n The authenticity of host \'192.168.98.202 (192.168.98.202)\' can\'t be established.\n ECDSA key fingerprint is SHA256:X4JeiiFuwV0cja81veAyGCosriEfZm/zv34cfYkuxmU.\n ECDSA key fingerprint is MD5:7d:17:0f:80:d5:2b:30:ec:2c:62:f9:79:6b:fb:5f:bc.\n Are you sure you want to continue connecting (yes/no)? yes\n /usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed\n /usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys\n root@192.168.98.202\'s password: \n \n Number of key(s) added: 1\n \n Now try logging into the machine, with:   "ssh \'root@192.168.98.202\'"\n and check to make sure that only the key(s) you wanted were added.\n \n #将公钥传给node3\n [root@manage01 ~]# ssh-copy-id -i .ssh/id_rsa.pub root@192.168.98.203\n /usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: ".ssh/id_rsa.pub"\n The authenticity of host \'192.168.98.203 (192.168.98.203)\' can\'t be established.\n ECDSA key fingerprint is SHA256:PtpsYBjaXkE+o3j8QYU5Ju8uPgcW2lVW8wsx4X1PV/c.\n ECDSA key fingerprint is MD5:50:a1:63:a0:ef:e7:61:26:11:25:ae:06:ec:93:cb:18.\n Are you sure you want to continue connecting (yes/no)? yes\n /usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed\n /usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys\n root@192.168.98.203\'s password: \n \n Number of key(s) added: 1\n \n Now try logging into the machine, with:   "ssh \'root@192.168.98.203\'"\n and check to make sure that only the key(s) you wanted were added.\n \n \n \n \n 小窍门\n 免交互创建公私钥\n [root@manage01 ansible]# ssh-keygen -f /root/.ssh/id_rsa -N ""   \n -f 指定密钥存放路径\n -N ""  新密码设置问空\n -P ""  老密码是什么\n \n \n 如何可以非交互式传公钥呢\n [root@manage01 ansible]# yum -y install sshpass\n [root@manage01 ansible]# sshpass -p111111 ssh-copy-id -o StrictHostKeyChecking=no -i /root/.ssh/id_rsa.pub root@192.168.98.202 \n \n \n StrictHostKeyChecking   严厉的主机监测=no  就不会问你yes|no了 \n sshpass 非交互式传密码\n \n \n 测试证书是否生效\n [root@manage01 ~]# for i in `seq 201 203`;do\n > ssh root@192.168.98.$i "hostname"\n > done\n node1\n node2\n node3\n \n 看到返回客户端的计算机名称\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br")])])])]),s._v(" "),n("h2",{attrs:{id:"二、ansible管理端部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二、ansible管理端部署"}},[s._v("#")]),s._v(" 二、ansible管理端部署")]),s._v(" "),n("h3",{attrs:{id:"_2-1-管理端安装ansible"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-管理端安装ansible"}},[s._v("#")]),s._v(" 2.1）管理端安装ansible")]),s._v(" "),n("p",[s._v("安装方式:")]),s._v(" "),n("p",[s._v("1）yum")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[root@manage01 ~]# yum -y install ansible\n[root@manage01 ~]# ansible --version\nansible 2.8.5\n  config file = /etc/ansible/ansible.cfg\n  configured module search path = ['/root/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules']\n  ansible python module location = /usr/lib/python3.6/site-packages/ansible\n  executable location = /usr/bin/ansible\n  python version = 3.6.8 (default, May 21 2019, 23:51:36) [GCC 8.2.1 20180905 (Red Hat 8.2.1-3)]\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("2） 源码")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("1、官网下载地址：https://releases.ansible.com/ansible\n[root@manage01 ~]# wget https://releases.ansible.com/ansible/ansible-2.9.3.tar.gz\n2、安装ansible\n[root@manage01 ~]# tar xf ansible-2.9.3.tar.gz \n[root@manage01 ~]# mv ansible-2.9.3 /opt/ansible\n[root@manage01 ~]# cd /opt/ansible-2.9.3\n#python软件包安装--1、安装依赖\n[root@manage01 ansible-2.9.0rc3]# pip3 install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple/\n[root@manage01 ansible]# ln -s /usr/bin/pip3 /usr/bin/pip\n#python软件包安装--2、安装软件\n[root@manage01 ansible-2.9.0rc3]# pip install --user ansible -i https://pypi.tuna.tsinghua.edu.cn/simple/\n\n#安装后设置\n[root@manage01 ~]# ln -s /usr/bin/python3 /usr/bin/python\n[root@manage01 ~]# ln -s /opt/ansible/bin/* /usr/bin/\n[root@manage01 ~]# cp /opt/ansible/examples/ansible.cfg /etc/ansible/\n[root@manage01 ~]# cp /opt/ansible/examples/hosts /etc/ansible/\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("p",[n("strong",[s._v("FAQ1")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[root@manage01 ansible-2.9.0rc3]# ./bin/ansible -m ping 192.168.98.201\n [WARNING]: No inventory was parsed, only implicit localhost is available\n\n [WARNING]: provided hosts list is empty, only localhost is available. Note that\nthe implicit localhost does not match 'all'\n\n [WARNING]: Could not match supplied host pattern, ignoring: 192.168.98.201\n \n 触发原因\n 执行ansible的时候回去读取客户端文件hosts，如果没有把客户端加入到hosts文件，就说明无法ansible无法管理。\n \n 解决方案\n [root@manage01 ansible]# mkdir /etc/ansible\n [root@manage01 ansible]# cp examples/hosts /etc/ansible/\n #将需要管理的客户端IP地址写入hosts文件,可以分组或者直接写\n [root@manage01 ~]# cat /etc/ansible/hosts \n 192.168.98.[201:203]\n \n 分组\n [group1]\n192.168.98.[201:203]\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("h3",{attrs:{id:"_2-2-ansible管理服务器部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-ansible管理服务器部署"}},[s._v("#")]),s._v(" 2.2）ansible管理服务器部署")]),s._v(" "),n("p",[s._v("管理端ansible目录：/etc/ansible")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[root@manage01 ansible]# tree \n.\n├── ansible.cfg           #ansible配置文件,不需要配置\n├── hosts\t\t\t\t\t\t\t\t\t#主机列表\n└── roles                 #角色列表\n\n1 directory, 2 files\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h3",{attrs:{id:"_2-3-部署主机列表-定义被监控机"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-部署主机列表-定义被监控机"}},[s._v("#")]),s._v(" 2.3）部署主机列表，定义被监控机")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('[root@manage01 ansible]# egrep -v "(^#|^$)" /etc/ansible/hosts \n[group1]\t\t\t\t\t#名字可以随便起  后面跟上业务机器的IP地址或者域名\n192.168.98.201\n192.168.98.202\n192.168.98.203\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[n("strong",[s._v("关于业务机器分组")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('分组中使用范围\n[nginx]\t\t\t\t\t组名\napache[1:10].aaa.com\t表示apache1.aaa.com到apache10.aaa.com这10台机器\nnginx[a:z].aaa.com\t\t表示nginxa.aaa.com到nginxz.aaa.com共26台机器\n10.1.1.[11:15]\t\t\t表示10.1.1.11到10.1.1.15这5台机器\n\n\n\n如果业务机器的SSH端口不是22\n10.1.1.13:2222\t\t\t表示10.1.1.13这台，但ssh端口为2222\n\n\n指定业务机器别名，未做免密登陆的机器可以通过下面的机器设置账号密码\nnginx1  ansible_ssh_host=10.1.1.13 ansible_ssh_port=2222 ansible_ssh_user=root ansible_ssh_pass="123456"\n\nansible_ssh_host  指定业务机器的IP或域名\nansible_ssh_port  指定业务机器的ssh端口\nansible_ssh_user  指定业务机器的ssh用户名\nansible_ssh_pass  指定业务机器的ssh用户名密码\n\n\n利用机器别名分组\nnginx1  ansible_ssh_host=10.1.1.13 ansible_ssh_port=2222 ansible_ssh_user=root ansible_ssh_pass="123456"\nnginx2  ansible_ssh_host=10.1.1.12\n\n[nginx]\nnginx1    #写服务器别名\nnginx2\n\n\n[root@manage01 ansible]# egrep -v "(^#|^$)" /etc/ansible/hosts \n#别名定义\nweb1 ansible_ssh_host=192.168.98.203 ansible_ssh_port=12121\n\n#分组\n[group1]\n192.168.98.201\n#未做免密登陆机器\n192.168.98.202:12121 ansible_ssh_user=sko ansible_ssh_pass=\'123\'\n#别名机器\nweb1 ansible_ssh_user=sko ansible_ssh_pass=\'123\'\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br")])]),n("h3",{attrs:{id:"_2-4-测试管理机和业务机器的联通性"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-测试管理机和业务机器的联通性"}},[s._v("#")]),s._v(" 2.4）测试管理机和业务机器的联通性")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('我们可以使用ansible通过调用ping模块来测试分组机器或某个机器\n-m 指定使用的模块   group1  业务机器分组\n#测试单个机器\n#测试主机列表中的机器\n\n\n#测试单个机器方法\n[root@manage01 ~]# ansible -m ping 192.168.98.201\n192.168.98.201 | SUCCESS => {\n    "ansible_facts": {\n        "discovered_interpreter_python": "/usr/libexec/platform-python"\n    },\n    "changed": false,\n    "ping": "pong"\n}\n\n#测试主机列表中的机器方法\n[root@manage01 ~]# ansible -m ping group1\n192.168.98.201 | SUCCESS => {\n    "ansible_facts": {\n        "discovered_interpreter_python": "/usr/libexec/platform-python"\n    },\n    "changed": false,\n    "ping": "pong"\n}\n192.168.98.203 | SUCCESS => {\n    "ansible_facts": {\n        "discovered_interpreter_python": "/usr/libexec/platform-python"\n    },\n    "changed": false,\n    "ping": "pong"\n}\n192.168.98.202 | SUCCESS => {\n    "ansible_facts": {\n        "discovered_interpreter_python": "/usr/libexec/platform-python"\n    },\n    "changed": false,\n    "ping": "pong"\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br")])]),n("h2",{attrs:{id:"三、学习视频"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三、学习视频"}},[s._v("#")]),s._v(" 三、学习视频")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://www.bilibili.com/video/BV19J41167sM?p=6",target:"_blank",rel:"noopener noreferrer"}},[s._v("视频：部署前准备"),n("OutboundLink")],1),s._v(" "),n("a",{attrs:{href:"https://www.bilibili.com/video/BV19J41167sM?p=7",target:"_blank",rel:"noopener noreferrer"}},[s._v("视频：ssh证书互信设置"),n("OutboundLink")],1),s._v(" "),n("a",{attrs:{href:"https://www.bilibili.com/video/BV19J41167sM?p=8",target:"_blank",rel:"noopener noreferrer"}},[s._v("视频：ansible平台部署"),n("OutboundLink")],1),s._v(" "),n("a",{attrs:{href:"https://www.bilibili.com/video/BV19J41167sM?p=9",target:"_blank",rel:"noopener noreferrer"}},[s._v("视频：主机列表文件hosts文件"),n("OutboundLink")],1),s._v(" "),n("a",{attrs:{href:"https://www.bilibili.com/video/BV19J41167sM?p=10",target:"_blank",rel:"noopener noreferrer"}},[s._v("视频：ansible自动化平台部署知识图谱"),n("OutboundLink")],1)])])}),[],!1,null,null,null);n.default=t.exports}}]);